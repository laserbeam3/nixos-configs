# My NixOS Configuration

I've started my journey through NixOS.

This is both my configs, as well as a learning jorunal through the platform. It's still the early days, so many things are still wrong. For now...

# What's the structure?

The structure is very much work in progress, but here's an overview right now.

```
├── features                      # Large sets of modules (eg. a complete desktop env)
├── flake.lock                    # Autogenerated
├── flake.nix                     # I only approximately know what a flake.nix file is
├── home                          # User specific configs
├── hosts                         # Host specific configs
├── README.md                     # You are here!
├── secrets                       # Encrytpted secrets
└── .sops.yaml                    # Configuration for the sops encryption modules
```

I essentially want to split my configs in large sets of _features_ with 1-4 top level .nix files, and import those features be it system wide from `hosts/<each_host>` and `home/<each_user>`. It'm still unsure how to do configs that apply per user per host. I'm unhappy with other solutions I found online (but will eventually find my way).

# What assumptions am I making when writing configs?

I will be making a few assumptions to simplify my learning curve of nixos. These assumptions may well break over time and I'll need to restructure things. It's fine to not over generalize on day 1.

1. I assume "catalin" is the only human user for the forseeable future.
2. I can write dotfiles directly in a `.dotfiles` folder and users will not need to alter them.
3. It's simpler to write dotfiles exactly as a package expects them (.toml, .ini...) instead of using the nix language. This is because I can copy paste from examples/documentation from other platforms.
4. I should only translate dotfiles to nix files when I need automation (for example paths change between hosts). When dotfiles move to the nix language, a whole file should be moved.
5. `home-manager` is the preferred way to add user-specific packages/configs. This is because `home-manager` appears to have default settings for many of the things I use.

NOTE. Assumption 3 is rapidly breaking because I can't just `home.file.".config" = <multiple folders in different nix files, that I want concatenated>`

# The motivational part

It was time to drop Windows and learn something new. I had used all major operating systems for a significant part of my life, and it was time to dig deeper. Something about NixOS grabbed my attention though...

1. I can configure all my computers in 1 place (at the time I started, I interacted with at least 4 computers on a regular basis).
2. I can reuse configuration between devices (if I change my desktop environment, it would propagate to all devices).
3. I can learn about all the pieces of software running on my computer.

However, learning NixOS is NOT easy. The documentation is shaky, and examples online are all over the place. Therefore I decided to jump headfirst and convert my home desktop to NixOS. I very quickly discovered one can't learn this distribution on the side. One should be confronted with problems and be forced to solve them.

You may also notice the first commit is quite involved. I had been using the os for a few weeks before adding encryption to all secrets used across my configs. I resited the urge to `git init` until I could safely do so.

So far, I've been having a blast, and I hope these configs are useful to you too.

# Why is this different from other references?

My main sources of inspiration when switching to this platform were:

1. The github of [Misterio77](https://github.com/Misterio77/nix-config/).
2. [Sascha Koening's](https://www.youtube.com/watch?v=43VvFgPsPtY&list=PLCQqUlIAw2cCuc3gRV9jIBGHeekVyBUnC) youtube playlist.

Both were invaluable resources when starting out. Yet, I've drastically changed my approach since day 1. My main concern with all resources I found online is they are shaped by nix. For example, both the links above have "overlays" built in on day 0... and I had no clue what overlays even are as a concept in nix (haven't actually needed them yet, as I type this). I removed "overlays" shortly before the first actual repo commit and will bring them back when I actually need them.

I want to think in terms of reusable features, not to shape my configs to fit the nix language. A good example of how this principle applies is `environment.systemVariables`. It's convenient to define all env vars in a single place as a dictionary in a single place, that's what the nix syntax encourages. But I prefer to define each env variable in context to where it's needed. Some env vars pend to the desktop, some to specific software, so I have multiple `environment.systemVariables` definitions, one per major feature (and they get concatenated as by nix when needed). I don't care about having my env vars in one location, I care about having my desktop inependent of my server software.

I also want to avoid having too many small files to jump around. You will generally find fewer large files with many small configs in them separated by comments.

Furthermore, I realized shared configs are good for documentation! These will be files I edit very rarely (as time goes on), so why not explain things? Config files aren't just a tool for declarative specification. They're also a tool for expressing my understanding of how things work and why things work.
